<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Smart charging algorithm — smart_charging • flextools</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Smart charging algorithm — smart_charging"><meta name="description" content="This function provides a framework to simulate different smart charging methods
(i.e. postpone, interrupt and curtail) to reach multiple goals (e.g. grid congestion,
net power minimization, cost minimization). See implementation examples and
the formulation of the optimization problems in the
documentation website."><meta property="og:description" content="This function provides a framework to simulate different smart charging methods
(i.e. postpone, interrupt and curtail) to reach multiple goals (e.g. grid congestion,
net power minimization, cost minimization). See implementation examples and
the formulation of the optimization problems in the
documentation website."><meta property="og:image" content="https://mcanigueral.github.io/flextools/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">flextools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/flextools.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Optimization problems</h6></li>
    <li><a class="dropdown-item" href="../articles/minimize_net_power.html">Net power optimization</a></li>
    <li><a class="dropdown-item" href="../articles/minimize_cost.html">Energy cost optimization</a></li>
    <li><a class="dropdown-item" href="../articles/combined_optimization.html">Combined optimization</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Demand-response</h6></li>
    <li><a class="dropdown-item" href="../articles/smart-charging.html">Smart charging</a></li>
    <li><a class="dropdown-item" href="../articles/smart-charging-advanced.html">Advanced smart charging</a></li>
    <li><a class="dropdown-item" href="../articles/user-profiles.html">User profiles in smart charging</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/mcanigueral/flextools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Smart charging algorithm</h1>
      <small class="dont-index">Source: <a href="https://github.com/mcanigueral/flextools/blob/HEAD/R/smart-charging.R" class="external-link"><code>R/smart-charging.R</code></a></small>
      <div class="d-none name"><code>smart_charging.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function provides a framework to simulate different smart charging methods
(i.e. postpone, interrupt and curtail) to reach multiple goals (e.g. grid congestion,
net power minimization, cost minimization). See implementation examples and
the formulation of the optimization problems in the
<a href="https://mcanigueral.github.io/flextools/">documentation website</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">smart_charging</span><span class="op">(</span></span>
<span>  <span class="va">sessions</span>,</span>
<span>  <span class="va">opt_data</span>,</span>
<span>  <span class="va">opt_objective</span>,</span>
<span>  <span class="va">method</span>,</span>
<span>  <span class="va">window_days</span>,</span>
<span>  <span class="va">window_start_hour</span>,</span>
<span>  responsive <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  power_th <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  charging_power_min <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  energy_min <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  include_log <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  show_progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  mc.cores <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sessions">sessions<a class="anchor" aria-label="anchor" href="#arg-sessions"></a></dt>
<dd><p>tibble, sessions data set containig the following variables:
<code>"Session"</code>, <code>"Timecycle"</code>, <code>"Profile"</code>, <code>"ConnectionStartDateTime"</code>, <code>"ConnectionHours"</code>, <code>"Power"</code> and <code>"Energy"</code>.</p></dd>


<dt id="arg-opt-data">opt_data<a class="anchor" aria-label="anchor" href="#arg-opt-data"></a></dt>
<dd><p>tibble, optimization contextual data.
The first column must be named <code>datetime</code> (mandatory) containing the
date time sequence where the smart charging algorithm is applied, so
only sessions starting within the time sequence of column <code>datetime</code>
will be optimized.
The other columns can be:</p><ul><li><p><code>static</code>: static power demand (in kW) from other sectors like buildings,
offices, etc.</p></li>
<li><p><code>grid_capacity</code>: maximum imported power from the grid (in kW),
for example the contracted power with the energy company.</p></li>
<li><p><code>production</code>: local power generation (in kW).
This is used when <code>opt_objective = "grid"</code>.</p></li>
<li><p><code>price_imported</code>: price for imported energy (€/kWh).
This is used when <code>opt_objective = "cost"</code>.</p></li>
<li><p><code>price_exported</code>: price for exported energy (€/kWh).
This is used when <code>opt_objective = "cost"</code>.</p></li>
<li><p><code>price_turn_down</code>: price for turn-down energy use (€/kWh).
This is used when <code>opt_objective = "cost"</code>.</p></li>
<li><p><code>price_turn_up</code>: price for turn-up energy use (€/kWh).
This is used when <code>opt_objective = "cost"</code>.</p></li>
</ul><p>If columns of <code>opt_data</code> are user profiles names, these are used as setpoints
and no optimization is performed for the corresponding user profiles.</p></dd>


<dt id="arg-opt-objective">opt_objective<a class="anchor" aria-label="anchor" href="#arg-opt-objective"></a></dt>
<dd><p>character, optimization objective being <code>"none"</code>, <code>"grid"</code>,
<code>"cost"</code> or a value between 0 (cost) and 1 (grid).
See details section for more information about the different objectives.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>character, scheduling method being <code>"none"</code>, <code>"postpone"</code>, <code>"curtail"</code> or <code>"interrupt"</code>.
If <code>none</code>, the scheduling part is skipped and the sessions returned in the
results will be identical to the original parameter.</p></dd>


<dt id="arg-window-days">window_days<a class="anchor" aria-label="anchor" href="#arg-window-days"></a></dt>
<dd><p>integer, number of days to consider as optimization window.</p></dd>


<dt id="arg-window-start-hour">window_start_hour<a class="anchor" aria-label="anchor" href="#arg-window-start-hour"></a></dt>
<dd><p>integer, starting hour of the optimization window.</p></dd>


<dt id="arg-responsive">responsive<a class="anchor" aria-label="anchor" href="#arg-responsive"></a></dt>
<dd><p>Named two-level list with the ratio (between 0 and 1)
of sessions responsive to smart charging program.
The names of the list must exactly match the Time-cycle and User profiles names.
For example: <code>list(Monday = list(Worktime = 1, Shortstay = 0.1))</code></p></dd>


<dt id="arg-power-th">power_th<a class="anchor" aria-label="anchor" href="#arg-power-th"></a></dt>
<dd><p>numeric, power threshold (between 0 and 1) accepted from setpoint.
For example, with <code>power_th = 0.1</code> and <code>setpoint = 100</code> for a certain time slot,
then sessions' demand can reach a value of <code>110</code> without needing to schedule sessions.</p></dd>


<dt id="arg-charging-power-min">charging_power_min<a class="anchor" aria-label="anchor" href="#arg-charging-power-min"></a></dt>
<dd><p>numeric. It can be configured in two ways:
(1) minimum allowed ratio (between 0 and 1) of nominal power (i.e. <code>Power</code> column in <code>sessions</code>), or
(2) specific value of minimum power (in kW) higher than 1 kW.</p>
<p>For example, if <code>charging_power_min = 0.5</code> and <code>method = 'curtail'</code>, sessions' charging power can only
be curtailed until the 50% of the nominal charging power.
And if <code>charging_power_min = 2</code>, sessions' charging power can be curtailed until 2 kW.</p></dd>


<dt id="arg-energy-min">energy_min<a class="anchor" aria-label="anchor" href="#arg-energy-min"></a></dt>
<dd><p>numeric, minimum allowed ratio (between 0 and 1) of required energy.</p></dd>


<dt id="arg-include-log">include_log<a class="anchor" aria-label="anchor" href="#arg-include-log"></a></dt>
<dd><p>logical, whether to output the algorithm messages for every user profile and time-slot</p></dd>


<dt id="arg-show-progress">show_progress<a class="anchor" aria-label="anchor" href="#arg-show-progress"></a></dt>
<dd><p>logical, whether to output the progress bar in the console</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>numeric, penalty on change for the flexible load.</p></dd>


<dt id="arg-mc-cores">mc.cores<a class="anchor" aria-label="anchor" href="#arg-mc-cores"></a></dt>
<dd><p>integer, number of cores to use.
Must be at least one, and parallelization requires at least two cores.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list with three elements:
optimal setpoints (tibble), sessions schedule (tibble) and log messages
(list with character strings). The date-time values in the log list are in
the time zone of the <code>opt_data</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>An important parameter of this function is <code>opt_data</code>, which defines the time
sequence of the smart charging algorithm and the optimization variables.
The <code>opt_data</code> parameter is directly related with the <code>opt_objective</code> parameter.
There are three different optimization objectives implemented by this function:</p><ul><li><p>Minimize grid interaction (<code>opt_objective = "grid"</code>): minimizes the peak of
the flexible load and the amount of imported power from the grid.
If <code>production</code> is not found in <code>opt_data</code>, only a peak shaving objective
will be considered.</p></li>
<li><p>Minimize the energy cost (<code>opt_objective = "cost"</code>): minimizes the energy cost.
In this case, the columns
<code>grid_capacity</code>, <code>price_imported</code>, <code>price_exported</code>,
<code>price_turn_up</code> and <code>price_turn_down</code> of tibble <code>opt_data</code> are important.
If these variables are not configured, default values of <code>grid_capacity = Inf</code>,
<code>price_imported = 1</code>, <code>price_exported = 0</code>, <code>price_turn_up = 0</code> and
<code>price_turn_down = 0</code> are considered to just minimize the imported energy.</p></li>
<li><p>Combined optimization (<code>opt_objective</code> between <code>0</code> and <code>1</code>): minimizes both
the net power peaks and energy cost.</p></li>
<li><p>No optimization (<code>opt_objective = "none"</code>): this will skip optimization and
at least one user profile name must be in an <code>opt_data</code> column to be
considered as a setpoint for the scheduling algorithm. The user profiles that
don't appear in <code>opt_data</code> will not be optimized.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example: we will use the example data set of charging sessions</span></span></span>
<span class="r-in"><span><span class="co"># from the `evsim` package.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The user profiles of this data set are `Visit` and `Worktime`,</span></span></span>
<span class="r-in"><span><span class="co"># identified in two different time cycles `Workday` and `Weekend`.</span></span></span>
<span class="r-in"><span><span class="co"># These two variables in the `sessions` tibble, `Profile` and `Timecycle`,</span></span></span>
<span class="r-in"><span><span class="co"># are required for the `smart_charging` function and give more versatility</span></span></span>
<span class="r-in"><span><span class="co"># to the smart charging context. For example, we may want to only coordinate</span></span></span>
<span class="r-in"><span><span class="co"># `Worktime` sessions instead of all sessions.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For this example we want the following:</span></span></span>
<span class="r-in"><span><span class="co"># - Curtail only `Worktime` sessions, which have a responsiveness rate of</span></span></span>
<span class="r-in"><span><span class="co"># 0.9 (i.e. 90% of Worktime users accept to postpone the session).</span></span></span>
<span class="r-in"><span><span class="co"># - Minimize the power peak of the sessions (peak shaving)</span></span></span>
<span class="r-in"><span><span class="co"># - Time series resolution of 15 minutes</span></span></span>
<span class="r-in"><span><span class="co"># - Optimization window of 24 hours from 6:00AM to 6:00 AM</span></span></span>
<span class="r-in"><span><span class="co"># - The energy charged can be reduced up to 50% of the original requirement</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sessions</span> <span class="op">&lt;-</span> <span class="fu">evsim</span><span class="fu">::</span><span class="va"><a href="mcanigueral.github.io/evsim/reference/california_ev_sessions_profiles.html">california_ev_sessions_profiles</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">evsim</span><span class="fu">::</span><span class="fu"><a href="mcanigueral.github.io/evsim/reference/adapt_charging_features.html">adapt_charging_features</a></span><span class="op">(</span>time_resolution <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sessions_demand</span> <span class="op">&lt;-</span> <span class="fu">evsim</span><span class="fu">::</span><span class="fu"><a href="mcanigueral.github.io/evsim/reference/get_demand.html">get_demand</a></span><span class="op">(</span><span class="va">sessions</span>, resolution <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Don't require any other variable than datetime, since we don't</span></span></span>
<span class="r-in"><span><span class="co"># care about local generation (just peak shaving objective)</span></span></span>
<span class="r-in"><span><span class="va">opt_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  datetime <span class="op">=</span> <span class="va">sessions_demand</span><span class="op">$</span><span class="va">datetime</span>,</span></span>
<span class="r-in"><span>  production <span class="op">=</span> <span class="fl">0</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sc_results</span> <span class="op">&lt;-</span> <span class="fu">smart_charging</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">sessions</span>, <span class="va">opt_data</span>, opt_objective <span class="op">=</span> <span class="st">"grid"</span>, method <span class="op">=</span> <span class="st">"curtail"</span>,</span></span>
<span class="r-in"><span>  window_days <span class="op">=</span> <span class="fl">1</span>, window_start_hour <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  responsive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Workday <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Worktime <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  energy_min <span class="op">=</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marc Cañigueral.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

